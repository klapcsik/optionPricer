<!doctype html>
<html lang="en" manifest="manifest.appcache">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <script src="components/jquery/jquery.js"></script>
        

    </head>
    <body>
        <div class="container">
            <div class="hero-unit">
                <h1>Option Pricer</h1>
                <form id='userForm'>
                  <fieldset>
                    <div class="form-group">
                      <label for="daysToExpiry">Days to Expiry</label>
                      <input type="text" class="form-control" id="daysToExpiry" placeholder="Days" value="365">
                    </div>
                    <div class="form-group">
                      <label for="strike">Strike Price</label>
                      <input type="text" class="form-control" id="strike" placeholder="Strike" value="150">
                    </div>
                    <div class="form-group">
                      <label for="spot">Underlying Price</label>
                      <input type="text" class="form-control" id="spot" placeholder="Underlying" value="100">
                    </div>
                    <div class="form-group">
                      <label for="riskFreeRate">Risk free rate</label>
                      <input type="text" class="form-control" id="riskFreeRate" placeholder="Risk free" value="0.05">
                    </div>
                    <div class="form-group">
                      <label for="volatility">Volatility</label>
                      <input type="text" class="form-control" id="volatility" placeholder="Volatility" value="0.5">
                    </div>
                    <div id="js-form-submit" type="submit" class="btn btn-default">Submit</button>
                  </fieldset>
                </form>
                <div id="optionsValue"></div>
            </div>
        </div>


        <script>
        // global app object
        var PRICER = {};

        $(document).ready(function () {

            function startWithResources(resources) {
                try {
                    eval(resources.js);
                    // Add CSS
                    $("head").append("<style>" + resources.css + "</style>");
                    PRICER.applicationController.start();
                } catch (e) {
                    console.log('error evaling javascript' + e);
                }
            }
            // eval javascript and css + insert into DOM
            function loadOnline(resources) {
                console.log('resources loaded succesfully ' + resources);
                startWithResources(resources);
                // store in localStorage for offline usage
                localStorage.resources = JSON.stringify(resources);
            }

            // handle offline *or* ajax request failure 
            function loadOffline() {
                var resources;
                if (localStorage && localStorage.resources) {
                    console.log('using resources from localStorage');
                    resources = JSON.parse(localStorage.resources);
                    startWithResources(resources);
                } else {
                    console.log('App start failure, no stored resources');
                }
            }

            // make ajax call for resources if online
            // use navigator.onLine === false as reliable for detecting truly offline, but not reliable for detecting online
            if (navigator && navigator.onLine === false) {
                loadOffline();
            } else {
                var jqxhr = $.ajax( "http://192.168.1.99:4711/api/resources" )
                    .done(function(resources) { loadOnline(resources); })
                    .fail(function() { console.log(jqxhr); loadOffline(); })
            }
        });

        </script>

</body>
</html>
